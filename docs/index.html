<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@xarc-dev/fastify-server</title><meta name="description" content="Documentation for @xarc-dev/fastify-server"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@xarc-dev/fastify-server</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>@xarc-dev/fastify-server</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#electrode-fastify-server-" id="electrode-fastify-server-" style="color: inherit; text-decoration: none;">
  <h1>Electrode Fastify Server <!-- omit in toc --></h1>
</a>
<p><a href="https://npmjs.org/package/@xarc/fastify-server"><img src="https://badge.fury.io/js/@xarc%2Ffastify-server.svg" alt="NPM version"></a> <a href="https://travis-ci.org/electrode-io/fastify-server"><img src="https://travis-ci.org/electrode-io/fastify-server.svg?branch=master" alt="Build Status"></a> <a href="https://david-dm.org/electrode-io/fastify-server"><img src="https://david-dm.org/electrode-io/fastify-server.svg?theme=shields.io" alt="Dependency Status"></a></p>
<p>This is an imaginatively named, configurable web server using Fastify atop Node.js.</p>
<p>The aim is to provide a standardized node web server that can be used to serve your web
application without the need for duplicating from another example, or starting from scratch.</p>
<p>The intention is that you will extend via configuration, such that this provides the baseline
functionality of a Fastify web server, and within your own application you will add on the
features, logic, etc unique to your situation.</p>
<p>This module requires Node v10.x.x+.</p>

<a href="#table-of-contents-" id="table-of-contents-" style="color: inherit; text-decoration: none;">
  <h2>Table Of Contents <!-- omit in toc --></h2>
</a>
<ul>
<li><a href="#installing">Installing</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#hello-world-example">Hello World Example</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#configuration-options">Configuration Options</a><ul>
<li><a href="#server-object"><code>server</code> (Object)</a></li>
<li><a href="#connection-object"><code>connection</code> (Object)</a></li>
<li><a href="#plugins-object"><code>plugins</code> (Object)</a></li>
<li><a href="#electrode-object"><code>electrode</code> (Object)</a></li>
<li><a href="#listener-function"><code>listener</code> (function)</a></li>
<li><a href="#keepalivetimeout-integer">keepAliveTimeout (integer)</a></li>
<li><a href="#loglevel">logLevel</a></li>
</ul>
</li>
<li><a href="#electrode-confippet">electrode-confippet</a></li>
<li><a href="#adding-a-fastify-plugin">Adding a Fastify plugin</a><ul>
<li><a href="#plugin-configs">Plugin configs</a><ul>
<li><a href="#about-plugin-priority">About Plugin Priority</a></li>
<li><a href="#more-about-register-and-module">More about register and module</a></li>
<li><a href="#exporting-your-fastify-plugin-from-a-module">Exporting your Fastify Plugin from a module</a></li>
<li><a href="#more-about-requirefrompath">More about <code>requireFromPath</code></a></li>
<li><a href="#plugin-timeout">Plugin timeout</a></li>
</ul>
</li>
<li><a href="#example-fastify-static">Example: <code>fastify-static</code></a></li>
</ul>
</li>
<li><a href="#api">API</a><ul>
<li><a href="#electrodeserver">electrodeServer</a></li>
<li><a href="#app-decorator"><code>app</code> decorator</a></li>
</ul>
</li>
<li><a href="#contributions">Contributions</a></li>
<li><a href="#license">License</a></li>
</ul>

<a href="#installing" id="installing" style="color: inherit; text-decoration: none;">
  <h2>Installing</h2>
</a>
<p><code>npm i --save @xarc/fastify-server</code></p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<p>Electrode Server comes with enough defaults such that you can spin up a Fastify server at <code>http://localhost:3000</code> with one call:</p>
<pre><code class="language-js"><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;@xarc/fastify-server&quot;</span><span class="hl-1">)();</span>
</code></pre>
<p>Of course that doesn&#39;t do much but getting a <code>404</code> response from <code>http://localhost:3000</code>.
To handle your routes, you should create a Fastify plugin to install your handlers.
See below for configuration options on how to register your plugin through <code>@xarc/fastify-server</code>.</p>

<a href="#hello-world-example" id="hello-world-example" style="color: inherit; text-decoration: none;">
  <h3>Hello World Example</h3>
</a>
<p>Here is an example with a default route to return a <code>Hello World</code> string for <code>http://localhost:3000</code>.</p>
<p>Through a plugin:</p>
<pre><code class="language-js"><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;@xarc/fastify-server&quot;</span><span class="hl-1">)({</span><br/><span class="hl-1">  </span><span class="hl-3">plugins:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">routes:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">register</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-3">instance</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">instance</span><span class="hl-1">.</span><span class="hl-0">route</span><span class="hl-1">({</span><br/><span class="hl-1">          </span><span class="hl-3">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;GET&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-3">path:</span><span class="hl-1"> </span><span class="hl-2">&quot;/&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-0">handler</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World&quot;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Using <code>deferStart</code> flag to get a server that hasn&#39;t started yet:</p>
<pre><code class="language-js"><span class="hl-5">//</span><br/><span class="hl-5">// fastify doesn&#39;t allow adding routes after server started</span><br/><span class="hl-5">// so need to set deferStart flag true to be able to add a route and then start the server.</span><br/><span class="hl-5">//</span><br/><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;@xarc/fastify-server&quot;</span><span class="hl-1">)({ </span><span class="hl-3">deferStart:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1"> }).</span><span class="hl-0">then</span><span class="hl-1">(</span><span class="hl-3">server</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">server</span><span class="hl-1">.</span><span class="hl-0">route</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">method:</span><span class="hl-1"> </span><span class="hl-2">&quot;GET&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">path:</span><span class="hl-1"> </span><span class="hl-2">&quot;/&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">handler</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World&quot;</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">server</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">();</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#configuration" id="configuration" style="color: inherit; text-decoration: none;">
  <h2>Configuration</h2>
</a>
<p>You can pass in a config object that controls every aspect of the Fastify server.</p>
<p>For example, if you want to spin up a server with HTTP compression off at port 9000:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">port:</span><span class="hl-1"> </span><span class="hl-8">9000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">compression:</span><span class="hl-1"> </span><span class="hl-4">false</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;@xarc/fastify-server&quot;</span><span class="hl-1">)(</span><span class="hl-3">config</span><span class="hl-1">);</span>
</code></pre>
<p>However, for a more complex application, it&#39;s recommended that you use a config composer such as <a href="https://www.npmjs.com/package/electrode-confippet">electrode-confippet</a> to manage your app configuration.</p>

<a href="#configuration-options" id="configuration-options" style="color: inherit; text-decoration: none;">
  <h2>Configuration Options</h2>
</a>
<p>Sample of supported options:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">server:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// options to be passed to fastify constructor</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// host, port etc</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">plugins:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// specify fastify plugins to be registered</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">listener</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-3">emitter</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// setup server startup event handlers</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">deferStart:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">, </span><span class="hl-5">// don&#39;t start the server, you need to call server.start()</span><br/><span class="hl-1">  </span><span class="hl-3">electrode:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// options specific to Electrode such as logLevel</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code></pre>
<p>All properties are optional (if not present, the default values shown below will be used).</p>
<p><code>server.app.config</code> is set to a object that&#39;s the combination of your config with <code>@xarc/fastify-server&#39;s</code> defaults applied.</p>

<a href="#server-object" id="server-object" style="color: inherit; text-decoration: none;">
  <h3><code>server</code> (Object)</h3>
</a>
<ul>
<li>Server options to pass to <a href="https://www.fastify.io/">Fastify</a></li>
</ul>
<p><strong>Default:</strong></p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">server</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">app</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-9">electrode</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#connection-object" id="connection-object" style="color: inherit; text-decoration: none;">
  <h3><code>connection</code> (Object)</h3>
</a>
<ul>
<li>Connection to setup for the Fastify server. Contains connection details for the server.</li>
<li>If you want multiple connections, you can start multiple instances of <code>@xarc/fastify-server</code></li>
</ul>
<p><strong>Default:</strong></p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">connection</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">host</span><span class="hl-1">: </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-3">env</span><span class="hl-1">.</span><span class="hl-7">HOST</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">address</span><span class="hl-1">: </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-3">env</span><span class="hl-1">.</span><span class="hl-7">HOST_IP</span><span class="hl-1"> || </span><span class="hl-2">&quot;0.0.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">port</span><span class="hl-1">: </span><span class="hl-0">parseInt</span><span class="hl-1">(</span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-3">env</span><span class="hl-1">.</span><span class="hl-7">PORT</span><span class="hl-1">, </span><span class="hl-8">10</span><span class="hl-1">) || </span><span class="hl-8">3000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">routes</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-9">cors</span><span class="hl-1">: </span><span class="hl-4">true</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#plugins-object" id="plugins-object" style="color: inherit; text-decoration: none;">
  <h3><code>plugins</code> (Object)</h3>
</a>
<ul>
<li>plugin registration objects, converted to an array of its values and passed to <a href="https://www.fastify.io/docs/latest/Server/#register">Fastify&#39;s <code>server.register</code></a></li>
</ul>
<p>Default is just empty object:</p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">plugins</span><span class="hl-1">: {</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#electrode-object" id="electrode-object" style="color: inherit; text-decoration: none;">
  <h3><code>electrode</code> (Object)</h3>
</a>
<p>Configure electrode provided options.</p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">electrode</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">eventTimeout</span><span class="hl-1">: </span><span class="hl-8">5000</span><span class="hl-1">, </span><span class="hl-5">// milliseconds to wait for server start event listeners to return</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<ul>
<li><code>eventTimeout</code> - <em>optional</em> milliseconds to wait for your server start event listeners to return. <em>default</em> <code>10000</code>. Set it to <code>0</code> or <code>false</code> to disable timeout completely.</li>
</ul>

<a href="#listener-function" id="listener-function" style="color: inherit; text-decoration: none;">
  <h3><code>listener</code> (function)</h3>
</a>
<ul>
<li><p>A function to install event listeners for the electrode server startup lifecycle.</p>
</li>
<li><p>The following events are supported:</p>
<ul>
<li><code>config-composed</code> - All configurations have been composed into a single one</li>
<li><code>server-created</code> - Fastify server created</li>
<li><code>plugins-sorted</code> - Plugins processed and sorted by priority</li>
<li><code>plugins-registered</code> - Plugins registered with Fastify</li>
<li><code>server-started</code> - Server started</li>
<li><code>complete</code> - Final step before returning</li>
</ul>
</li>
</ul>
<p>To receive events you must set <code>config.listener</code> before calling <code>electrodeServer</code>.</p>
<p>For example:</p>
<pre><code class="language-js"><span class="hl-3">myConfig</span><span class="hl-1">.</span><span class="hl-0">listener</span><span class="hl-1"> = (</span><span class="hl-3">emitter</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">emitter</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;server-created&quot;</span><span class="hl-1">, (</span><span class="hl-3">data</span><span class="hl-1">, </span><span class="hl-3">next</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// do something</span><br/><span class="hl-1">    </span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code></pre>
<ul>
<li><p>The data object will contain these: <code>emitter</code>, <code>server</code>, <code>config</code>, and <code>plugins</code>.</p>
</li>
<li><p>Depending on the stage some may not be present. For example, <code>server</code> is not available until <code>server-created</code> event and <code>plugins</code> is not available until <code>plugins-sorted</code> event.</p>
</li>
<li><p>These are async events so you have to take and call a <code>next</code> callback.</p>
</li>
</ul>

<a href="#keepalivetimeout-integer" id="keepalivetimeout-integer" style="color: inherit; text-decoration: none;">
  <h3>keepAliveTimeout (integer)</h3>
</a>
<p>NodeJS defaults to 5 seconds keep-alive timeout. <code>fastify-server</code> defaults to 60 seconds timeout. If you want a custom timeout, use the <code>keepAliveTimeout</code> option (in milliseconds).</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">&quot;keepAliveTimeout&quot;</span><span class="hl-1">: </span><span class="hl-8">60000</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#loglevel" id="loglevel" style="color: inherit; text-decoration: none;">
  <h3>logLevel</h3>
</a>
<p>You can control how much output the Electrode Server logs to the console by setting the <code>logLevel</code>.</p>
<ul>
<li>Levels are <code>&quot;info&quot;</code>, <code>&quot;warn&quot;</code>, <code>&quot;error&quot;</code>, <code>&quot;none&quot;</code>.</li>
<li>A level of <code>&quot;warn&quot;</code> means only warnning and error messages will be printed.</li>
<li><strong>Default</strong> is <code>&quot;info&quot;</code></li>
</ul>
<p>For example, to suppress the banner that is shown when the server starts up:</p>
<pre><code><span class="hl-3">Fastify</span><span class="hl-1"> </span><span class="hl-3">server</span><span class="hl-1"> </span><span class="hl-3">running</span><span class="hl-1"> </span><span class="hl-3">at</span><span class="hl-1"> </span><span class="hl-9">http</span><span class="hl-1">:</span><span class="hl-5">//mypc:4000</span>
</code></pre>
<p>set the logLevel to &quot;warn&quot; or &quot;error&quot;:</p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">electrode</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">logLevel</span><span class="hl-1">: </span><span class="hl-2">&quot;warn&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#electrode-confippet" id="electrode-confippet" style="color: inherit; text-decoration: none;">
  <h2>electrode-confippet</h2>
</a>
<p>To keep your environment specific configurations manageable, you can use <a href="https://www.npmjs.com/package/electrode-confippet">electrode-confippet</a>.</p>
<p>Once you have your config files setup according to the <a href="https://www.npmjs.com/package/electrode-confippet#configuration-files">configuration files setup</a>, you can simply pass the config object to electrode server.</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;electrode-confippet&quot;</span><span class="hl-1">).</span><span class="hl-3">config</span><span class="hl-1">;</span><br/><br/><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;@xarc/fastify-server&quot;</span><span class="hl-1">)(</span><span class="hl-3">config</span><span class="hl-1">);</span>
</code></pre>

<a href="#adding-a-fastify-plugin" id="adding-a-fastify-plugin" style="color: inherit; text-decoration: none;">
  <h2>Adding a Fastify plugin</h2>
</a>
<p>You can have <code>@xarc/fastify-server</code> register any Fastify plugin that you want
through your configuration file.</p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">plugins</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;&lt;plugin-id&gt;&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-3">enable:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">options:</span><span class="hl-1"> {},</span><br/><span class="hl-1">      </span><span class="hl-0">register</span><span class="hl-3">:</span><span class="hl-1"> (</span><span class="hl-3">fastify</span><span class="hl-1">, </span><span class="hl-3">opts</span><span class="hl-1">, </span><span class="hl-3">done</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> { </span><span class="hl-0">done</span><span class="hl-1">() }, </span><span class="hl-5">// mutual exclusive with module</span><br/><span class="hl-1">      </span><span class="hl-3">module:</span><span class="hl-1"> </span><span class="hl-2">&quot;&lt;plugin-module-name&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">requireFromPath:</span><span class="hl-1"> </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-3">priority:</span><span class="hl-1"> </span><span class="hl-8">210</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">fastifyPluginDecorate:</span><span class="hl-1"> </span><span class="hl-4">false</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#plugin-configs" id="plugin-configs" style="color: inherit; text-decoration: none;">
  <h3>Plugin configs</h3>
</a>
<ul>
<li><code>&lt;plugin-id&gt;</code> - ID for the plugin. Generally the module name for the plugin, which is used to load it for registration.</li>
<li><code>enable</code> - <em>optional</em> if set to <code>false</code> then this plugin won&#39;t be registered. If it&#39;s not set then it&#39;s considered to be <code>true</code>.</li>
<li><code>options</code> - <em>optional</em> Object that&#39;s passed to the plugin&#39;s register function.</li>
<li><code>register</code> - <em>optional</em> The Fastify plugin function. Overrides <code>module</code>.</li>
<li><code>module</code> - <em>optional</em> name of the module to load for the plugin instead of the <code>&lt;plugin-id&gt;</code></li>
<li><code>requireFromPath</code> - <em>optional</em> The path from which to call <code>require</code> to load the plugin module</li>
<li><code>priority</code> - <em>optional</em> integer value to indicate the plugin&#39;s registration order<ul>
<li>Lower value ones are register first</li>
<li>Default to <code>Infinity</code> if this field is missing or has no valid integer value (<code>NaN</code>) (string of number accepted)</li>
</ul>
</li>
<li><code>fastifyPluginDecorate</code> - <em>optional</em> fastify-server auto decorates your plugin with <a href="https://www.npmjs.com/package/fastify-plugin">fastify-plugin</a> - set this to <code>false</code> to disable this behavior. This can also be set to an object to use as options for <a href="https://www.npmjs.com/package/fastify-plugin">fastify-plugin</a>.</li>
</ul>

<a href="#about-plugin-priority" id="about-plugin-priority" style="color: inherit; text-decoration: none;">
  <h4>About Plugin Priority</h4>
</a>
<p>Priority allows you to arrange plugins to be registered in an order you prefer. The plugins with lower priority values are registered first.</p>

<a href="#more-about-register-and-module" id="more-about-register-and-module" style="color: inherit; text-decoration: none;">
  <h4>More about register and module</h4>
</a>
<p>If you don&#39;t want to use <code>&lt;plugin-id&gt;</code> to load the module, then you can optionally specify one of the following:</p>
<ul>
<li><code>register</code> - if specified, then treat as the plugin&#39;s <code>register</code> function to pass to Fastify, <strong><em>overides module</em></strong></li>
<li><code>module</code> - Only used if <code>register</code> is not specified<ul>
<li>If it&#39;s a string the used as the name module to <code>require</code> for registration.</li>
<li>It it&#39;s <code>false</code> then electrode server will not load any module.</li>
<li>You can specify a <a href="https://www.npmjs.com/package/require-from-path">require-from-path</a> for the module using an object.</li>
</ul>
</li>
</ul>
<pre><code class="language-js"><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-9">plugins</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-9">myPlugin</span><span class="hl-1">: {</span><br/><span class="hl-1">              </span><span class="hl-9">module</span><span class="hl-1">: {</span><br/><span class="hl-1">                </span><span class="hl-9">requireFromPath</span><span class="hl-1">: </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">(),</span><br/><span class="hl-1">                </span><span class="hl-9">name</span><span class="hl-1">: </span><span class="hl-2">&quot;my-plugin-module&quot;</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span>
</code></pre>

<a href="#exporting-your-fastify-plugin-from-a-module" id="exporting-your-fastify-plugin-from-a-module" style="color: inherit; text-decoration: none;">
  <h4>Exporting your Fastify Plugin from a module</h4>
</a>
<p>Electrode fastify server will try to find your Fastify Plugin from your module by looking through these fields:</p>
<ol>
<li><code>mod.fastifyPlugin</code></li>
<li><code>mod.default.fastifyPlugin</code> (ES6 Module)</li>
<li><code>mod.plugin</code></li>
<li><code>mod.default</code> (ES6 Module)</li>
<li><code>mod</code> itself</li>
</ol>
<p>Examples:</p>
<ol>
<li>Exporting the plugin directly as the module:</li>
</ol>
<p>CommonJS example:</p>
<pre><code class="language-js"><span class="hl-11">module</span><span class="hl-1">.</span><span class="hl-11">exports</span><span class="hl-1"> = </span><span class="hl-3">myPlugin</span><span class="hl-1">;</span>
</code></pre>
<pre><code class="language-js"><span class="hl-11">module</span><span class="hl-1">.</span><span class="hl-11">exports</span><span class="hl-1">.</span><span class="hl-3">fastifyPlugin</span><span class="hl-1"> = </span><span class="hl-3">myPlugin</span><span class="hl-1">;</span>
</code></pre>
<p>ES6 example:</p>
<pre><code class="language-js"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-6">default</span><span class="hl-1"> </span><span class="hl-3">myPlugin</span><span class="hl-1">;</span>
</code></pre>
<pre><code class="language-js"><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-3">fastifyPlugin</span><span class="hl-1">;</span>
</code></pre>
<p>With <code>fastify-plugin</code>:</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-7">fastifyPlugin</span><span class="hl-1"> = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&quot;fastify-plugin&quot;</span><span class="hl-1">);</span><br/><span class="hl-11">module</span><span class="hl-1">.</span><span class="hl-11">exports</span><span class="hl-1"> = </span><span class="hl-0">fastifyPlugin</span><span class="hl-1">(</span><span class="hl-3">myPlugin</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-3">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;myPlugin&quot;</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#more-about-requirefrompath" id="more-about-requirefrompath" style="color: inherit; text-decoration: none;">
  <h4>More about <code>requireFromPath</code></h4>
</a>
<p>There are three places you can specify a path to call <code>require</code> from when loading your plugin modules.</p>
<ol>
<li><code>config.plugins.requireFromPath</code> - The top one used for all plugins</li>
<li><code>config.plugins.&lt;plugin-id&gt;.requireFromPath</code> - Used for the specific plugin of <code>&lt;plugin-id&gt;</code>, <strong>overrides the one above</strong></li>
<li><code>config.plugins.&lt;plugin-id&gt;.module.requireFromPath</code> - Used for the specific plugin of <code>&lt;plugin-id&gt;</code>, <strong>overrides the two above</strong></li>
</ol>
<p>For more information: check out <a href="https://www.npmjs.com/package/require-from-path">require-from-path</a></p>

<a href="#plugin-timeout" id="plugin-timeout" style="color: inherit; text-decoration: none;">
  <h4>Plugin timeout</h4>
</a>
<p>To configure the plugin timeout, use Fastify&#39;s <code>pluginTimeout</code> option.</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">&quot;server&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-10">&quot;pluginTimeout&quot;</span><span class="hl-1">: </span><span class="hl-8">10000</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Uses the Fastify default if none is specified.</p>

<a href="#example-fastify-static" id="example-fastify-static" style="color: inherit; text-decoration: none;">
  <h3>Example: <code>fastify-static</code></h3>
</a>
<p><strong>Here&#39;s an example using the <code>fastify-static</code> plugin:</strong></p>
<p>First, install the plugin as you normally would from <code>npm</code>:</p>
<p><code>npm i --save fastify-static</code></p>
<p>Then, add your plugin to the config <code>plugins</code> section.</p>
<pre><code class="language-js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">plugins</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;fastify-static&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-3">enable:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">options:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">root:</span><span class="hl-1"> </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">()</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-3">priority:</span><span class="hl-1"> </span><span class="hl-8">210</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">requireFromPath:</span><span class="hl-1"> </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-0">cwd</span><span class="hl-1">()</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Above config tells <code>@xarc/fastify-server</code> to <code>require</code> from <code>CWD</code> the module by its <code>&lt;plugin-id&gt;</code> <code>&quot;fastify-static&quot;</code> and register it as a plugin with Fastify. Options passes in the required <code>root</code> option to <code>fastify-static</code>.</p>

<a href="#api" id="api" style="color: inherit; text-decoration: none;">
  <h2>API</h2>
</a>
<p>The electrode server exports a single API.</p>

<a href="#electrodeserver" id="electrodeserver" style="color: inherit; text-decoration: none;">
  <h3><a href="#electrodeserver">electrodeServer</a></h3>
</a>
<p><code>electrodeServer(config, [decors], [callback])</code></p>
<ul>
<li><p><code>config</code> is the <a href="#configuration-options">electrode server config</a></p>
</li>
<li><p><code>decors</code> - Optional extra <code>config</code> or array of <code>config</code>. In case you have common config you want to put inside a dedicated module, you can pass them in here.</p>
<ul>
<li>If it&#39;s an array like <code>[ decor1, decor2, decor3 ]</code> then each one is composed into the main config. ie: something similar to <code>_.merge(mainConfig, decor1, decor2, decor3)</code>.</li>
</ul>
</li>
<li><p><code>callback</code> is an optional errback with the signature <code>function (err, server)</code></p>
<ul>
<li>where <code>server</code> is the Fastify server</li>
</ul>
</li>
<li><p><strong>Returns:</strong> a promise resolving to the Fastify server if callback is not provided</p>
</li>
</ul>

<a href="#app-decorator" id="app-decorator" style="color: inherit; text-decoration: none;">
  <h3><code>app</code> decorator</h3>
</a>
<p>Elecrode server also provides the <code>app</code> decorator on the server and request objects.
The <code>app</code> object contains the fully merged final <code>config</code>.</p>
<pre><code class="language-js"><span class="hl-9">handler</span><span class="hl-1">: (</span><span class="hl-3">request</span><span class="hl-1">, </span><span class="hl-3">reply</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Listening on &quot;</span><span class="hl-1">, </span><span class="hl-3">request</span><span class="hl-1">.</span><span class="hl-3">app</span><span class="hl-1">.</span><span class="hl-3">config</span><span class="hl-1">.</span><span class="hl-3">connection</span><span class="hl-1">.</span><span class="hl-3">port</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#contributions" id="contributions" style="color: inherit; text-decoration: none;">
  <h2>Contributions</h2>
</a>
<p>Make sure you sign the CLA. Checkout the <a href="https://github.com/electrode-io/electrode/blob/master/CONTRIBUTING.md">contribution guide</a></p>
<p>To run tests</p>
<pre><code class="language-sh"><span class="hl-1">% npm </span><span class="hl-2">i</span><br/><span class="hl-1">% clap </span><span class="hl-2">test</span>
</code></pre>
<p>To run tests and coverage</p>
<pre><code class="language-sh"><span class="hl-1">% clap </span><span class="hl-2">check</span>
</code></pre>
<p>To run sample server</p>
<pre><code class="language-sh"><span class="hl-1">% npm </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">sample</span>
</code></pre>
<p>Hit <code>http://localhost:9000</code>
Hit <code>http://localhost:9000/html/hello.html</code> to test static path.</p>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p>Copyright 2016-present WalmartLabs</p>
<p>Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">@xarc-<wbr/>dev/fastify-<wbr/>server</a>
<ul></ul></li>
<li class="tsd-kind-namespace tsd-is-external"><a href="modules/Fastify.html">Fastify</a></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-interface"><a href="interfaces/ElectrodeFastifyInstance.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-256-path"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)" id="icon-256-text"></path></svg>Electrode<wbr/>Fastify<wbr/>Instance</a></li>
<li class="tsd-kind-type-alias"><a href="types/ConnectionConfig.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-4194304-path"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)" id="icon-4194304-text"></path></svg>Connection<wbr/>Config</a></li>
<li class="tsd-kind-type-alias"><a href="types/ElectrodeOptions.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Electrode<wbr/>Options</a></li>
<li class="tsd-kind-type-alias"><a href="types/ElectrodeServerConfig.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Electrode<wbr/>Server<wbr/>Config</a></li>
<li class="tsd-kind-type-alias"><a href="types/PluginOptions.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Plugin<wbr/>Options</a></li>
<li class="tsd-kind-type-alias"><a href="types/PluginsConfig.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Plugins<wbr/>Config</a></li>
<li class="tsd-kind-type-alias"><a href="types/ServerInfo.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-4194304-path"></use><use href="#icon-4194304-text"></use></svg>Server<wbr/>Info</a></li>
<li class="tsd-kind-function tsd-is-external"><a href="functions/Fastify-1.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg>Fastify</a></li>
<li class="tsd-kind-function"><a href="functions/electrodeServer.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><use href="#icon-64-path"></use><use href="#icon-64-text"></use></svg>electrode<wbr/>Server</a></li></ul></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>